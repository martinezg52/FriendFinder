<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Geo's Friend Finder | Survey</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
</head>
<body>

    <!-- Putting everything inside a div container-->
    <div class = "container">
      

        <!-- Survey Page Title -->
        <div class="page-header">
          <h1 style="font-size: 45px;"><span class="glyphicon glyphicon-sunglasses" style="color: #d9534f;"></span> Geo's Friend Finder Survey  <span class="glyphicon glyphicon-sunglasses" style="color: #d9534f;"></span></h1>
        </div>
  
  
        <!-- User Name and Photo Panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><strong>About You</strong></h3>
          </div>
          <div class="panel-body">
            <h4>Your Full Name</h4>
            <div class="input-group">
              <input id = "formName" class="form-control" type="text" name="name" placeholder="John Doe">
              <span class="input-group-addon">(Required)</span>
            </div>  
            <br>
            <h4>Link to your Photo Image</h4>
            <div class="input-group">
              <input id = "formImage" class="form-control" type="text" name="name" placeholder="http://yourphotolink.com.jpg/">
              <span class="input-group-addon">(Required)</span>
            </div>
          </div>
        </div>
  
  
        <!-- Survey Page Questions Panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><strong>START THE SURVEY</strong></h3>
          </div>
          <div class="panel-body">
            
            <!-- Question 1 -->
            <h4><strong>Question 1</strong></h4>
            <h5>You like to eat cheeseburgers.</h5>
            <select data-placeholder="" class="chosen-select" id="Q1">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 2 -->
            <h4><strong>Question 2</strong></h4>
            <h5>You think of yourself as an intelectual person.</h5>
            <select data-placeholder="" class="chosen-select" id="Q2">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 3 -->
            <h4><strong>Question 3</strong></h4>
            <h5>You are energized when interacting with other people.</h5>
            <select data-placeholder="" class="chosen-select" id="Q3">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 4 -->
            <h4><strong>Question 4</strong></h4>
            <h5>You love the liquor.</h5>
            <select data-placeholder="" class="chosen-select" id="Q4">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 5 -->
            <h4><strong>Question 5</strong></h4>
            <h5>You consider yourself to be outgoing.</h5>
            <select data-placeholder="" class="chosen-select" id="Q5">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 6 -->
            <h4><strong>Question 6</strong></h4>
            <h5>You often find yourself lost in thought when you are at work.</h5>
            <select data-placeholder="" class="chosen-select" id="Q6">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 7 -->
            <h4><strong>Question 7</strong></h4>
            <h5>You are more of a natural improviser than a careful planner.</h5>
            <select data-placeholder="" class="chosen-select" id="Q7">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 8 -->
            <h4><strong>Question 8</strong></h4>
            <h5>You prefer bootsrap over materialize.</h5>
            <select data-placeholder="" class="chosen-select" id="Q8">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 9 -->
            <h4><strong>Question 9</strong></h4>
            <h5>You would like to live at the sunnyvale trailerpark.</h5>
            <select data-placeholder="" class="chosen-select" id="Q9">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
            <!-- Question 10 -->
            <h4><strong>Question 10</strong></h4>
            <h5>You like to party</h5>
            <select data-placeholder="" class="chosen-select" id="Q10">
              <option value=""></option>
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5 (Strongly Agree)</option>
            </select>
  
          </div>
        </div>
  
  
        <!-- Survey Submit Button -->
        <button id="submitButton" type="submit" class="btn btn-md btn-danger btn-block"><h4><span class="glyphicon glyphicon-send"></span> Submit</h4></button> 
    
        <br>
  
        <!-- Website Footer -->
        <footer class="footer">
          <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/martinezg52/FriendFinder" target="_blank">GitHub Repo</a> | <a href="/">Home</a></p>
        </footer> 
  
  
        <!-- Match Modal -->
        <div id="resultsModal" class="modal fade" role="dialog">
          <div class="modal-dialog">
  
            <!-- Modal Content-->
            <div class="modal-content">
  
              <!-- "X" Button to close the modal -->
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h2 class="modal-title"><strong>Meet Your New Friend!</strong></h2>
              </div>
  
              <!-- Modal Body (For Match Info) -->
              <div class="modal-body">
                <h2 id="matchName"></h2>
                <img id="matchImg" src="" alt="Image Not Found" style="max-width: 350px;">
              </div>
  
              <!-- Modal Footer (Close Button) -->
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
  
            </div>
  
          </div>
        </div>
  
  
      </div>
  <!-- Link in jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>


  <!-- Latest compiled and minified JavaScript (USED FOR THE MODAL) -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
  <script>
  
var allFieldsCompleted;

$(document).ready(function() {
  
    // Event Listener for Submission
  $('#submitButton').on('click', function() {
    
    // Check if all the user fields are completed and proceed with ajax call, otherwise display message
    checkIfComplete(function(){
    
      if(allFieldsCompleted){
        collectInputs();
      }
      else{
        alert('Please complete all fields before submitting!');
      }
    }); // end checkIfComplete() callback
  }); // end submit listener
}); // document ready

// Function to valid user input
function checkIfComplete(callback){
  // Check through all the questions (i.e. iterate through all of class "chosen-select")
  var questionsCompleted;
  $('.chosen-select').each(function(){
    if ( $(this).val() == "" ){
      questionsCompleted = false;
    }
  })
  // This counters the async behavior of $.each()
  .promise().done(function(){
    // Check if any questions are incomplete
    if(questionsCompleted == false){
      allFieldsCompleted = false;
    }
    // Determine if Name is entered
    else if( $('#formName').val().trim() == "" ){
      allFieldsCompleted = false;
    }
    // Determine if Link is entered
    else if( $('#formImage').val().trim() == "" ){
      allFieldsCompleted = false;
    }
    // Otherwise, the all fields are completed
    else{
      allFieldsCompleted = true;
    }
    // Fire Off Callback (to counter async behavior of $.each)
    callback();       
  });
}
function collectInputs(){
  // Make new friend object
  var newFriend = {
    name: $('#formName').val().trim(),
    photo: $('#formImage').val().trim(),
    scores: []
  };
  // Loop through Questions to get scores
  var scoresArray = [];
  $('.chosen-select').each(function(){
    scoresArray.push( parseInt( $(this).val() ) ); // Parse Input Value as integer
  })
   // Creating a promise to counter the async behavior of $.each()
  .promise().done(function(){
    
    // Push the array of scores to the new friend object
    newFriend.scores = scoresArray;
    
    // POST the newFriend to the friends.js file and get back the best match
    var currentURL = window.location.origin;
    $.post(currentURL + "/api/friends", newFriend, function(data){
      
      // Add Best Match attributes to Modal
      $('#matchName').text(data.name);
      $('#matchImg').attr('src', data.photo);
     
      // Show the modal with the best match 
      $("#resultsModal").modal('toggle');
    }); // end AJAX POST
  });
}

  
  </script>


  
</body>
</html>